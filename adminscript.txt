
  <script>
   


    <!--                                                 Cropper JS                                  -->
    <script>
    // ‚úÖ Disable autoDiscover to avoid double initialization
    Dropzone.autoDiscover = false;

    // üü¢ Initialize Dropzone
    const adminDropzone = new Dropzone("#admin-dropzone", {
    url: "http://127.0.0.1:5000/analyze", // Flask detection endpoint
    maxFiles: 10,
    maxFilesize: 5,
    acceptedFiles: "image/*",
    addRemoveLinks: true,
    dictRemoveFile: "√ó",
    dictDefaultMessage: "",
    clickable: ".select-btn",
    autoProcessQueue: false,
    parallelUploads: 10,
    uploadMultiple: true,
    paramName: "image",
    method: "post",

    init: function () {
        this.on("error", function (file, errorMessage) {
        console.error("‚ùå Upload error:", errorMessage);
        showErrorModal("‚ùå Upload failed. Please check your file.");
        });
    }
    });

    // üü° Drag-over feedback
    const adminDropzoneElement = document.getElementById("admin-dropzone");
    adminDropzone.on("dragenter", () => adminDropzoneElement.classList.add("drag-over"));
    adminDropzone.on("dragleave", () => adminDropzoneElement.classList.remove("drag-over"));
    adminDropzone.on("drop", () => adminDropzoneElement.classList.remove("drag-over"));

    // üñ± Analyze Button (ADMIN)
    const adminAnalyzeBtn = document.getElementById("admin-analyze-btn");
    const originalAdminBtnText = adminAnalyzeBtn.textContent;

    adminAnalyzeBtn.addEventListener("click", () => {
    if (adminDropzone.files.length === 0) {
        showErrorModal("‚ö†Ô∏è Please upload at least one image before analyzing.");
        return;
    }

    console.log(`üëÆ‚Äç‚ôÇÔ∏è Admin uploading ${adminDropzone.files.length} images for detection...`);

    // ‚ú® Start loading animation
    adminAnalyzeBtn.disabled = true;
    adminAnalyzeBtn.innerHTML = `<div class="spinner"></div> Analyzing...`;

    adminDropzone.processQueue();
    });

    // ‚úÖ On success ‚Äî redirect to results page
    adminDropzone.on("successmultiple", (files, response) => {
    console.log("‚úÖ Flask response (Admin):", response);

    // üß† Store detection result in localStorage
    localStorage.setItem("detectionResult", JSON.stringify(response));

    // üü¢ Restore button state
    adminAnalyzeBtn.disabled = false;
    adminAnalyzeBtn.textContent = originalAdminBtnText;

    // ‚úÖ Redirect to admin result page
    window.location.href = "/index_result.php";
    });

    // ‚ùå On error
    adminDropzone.on("errormultiple", (files, errorMessage) => {
    console.error("‚ùå Error during detection:", errorMessage);
    showErrorModal("‚ùå Detection failed. Check Flask server.");

    // üõë Stop loading animation
    adminAnalyzeBtn.disabled = false;
    adminAnalyzeBtn.textContent = originalAdminBtnText;
    });

    /* ===============================
    üî¥ Error & Feedback Modals
    ================================= */
    function showErrorModal(message) {
    createModal(message, "#d9534f");
    }

    function createModal(message, bgColor) {
    let modal = document.getElementById("feedback-modal");
    let msg = document.getElementById("feedback-message");

    if (!modal) {
        modal = document.createElement("div");
        modal.id = "feedback-modal";
        modal.style.position = "fixed";
        modal.style.top = 0;
        modal.style.left = 0;
        modal.style.width = "100%";
        modal.style.height = "100%";
        modal.style.background = "rgba(0,0,0,0.5)";
        modal.style.display = "flex";
        modal.style.alignItems = "center";
        modal.style.justifyContent = "center";
        modal.style.zIndex = "9999";

        const content = document.createElement("div");
        content.style.background = "#fff";
        content.style.padding = "20px 30px";
        content.style.borderRadius = "10px";
        content.style.textAlign = "center";
        content.style.minWidth = "300px";

        msg = document.createElement("p");
        msg.id = "feedback-message";
        msg.style.fontSize = "16px";
        msg.style.marginBottom = "15px";

        const closeBtn = document.createElement("button");
        closeBtn.textContent = "Close";
        closeBtn.style.background = bgColor;
        closeBtn.style.color = "#fff";
        closeBtn.style.border = "none";
        closeBtn.style.padding = "8px 20px";
        closeBtn.style.borderRadius = "5px";
        closeBtn.style.cursor = "pointer";
        closeBtn.addEventListener("click", () => {
        modal.style.display = "none";
        });

        content.appendChild(msg);
        content.appendChild(closeBtn);
        modal.appendChild(content);
        document.body.appendChild(modal);
    }

    msg.textContent = message;
    modal.querySelector("button").style.background = bgColor;
    modal.style.display = "flex";
    }





    </script>

    <script>
        $(function() {
            $('input[name="daterange"]').daterangepicker({
                opens: 'left'
            }, function(start, end, label) {
                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
            });
        });

        // === DROPDOWN ===
        const dropdownBtn = document.getElementById("actionDropdown");
        const dropdownMenu = document.getElementById("dropdownMenu");

        dropdownBtn.addEventListener("click", () => {
            dropdownMenu.style.display =
                dropdownMenu.style.display === "block" ? "none" : "block";
        });

        dropdownMenu.querySelectorAll("li").forEach((item) => {
            item.addEventListener("click", () => {
                dropdownBtn.innerHTML = `${item.textContent} <i class="fa-solid fa-chevron-down"></i>`;
                dropdownMenu.style.display = "none";
            });
        });

        // Close dropdown when clicking outside
        document.addEventListener("click", (e) => {
            if (!dropdownBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                dropdownMenu.style.display = "none";
            }
        });


        // ===== Pagination Simulation =====
        let currentPage = 1;
        const totalPages = 10;
        const pageInfo = document.getElementById('pageInfo');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        function updatePagination() {
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }

        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                updatePagination();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                updatePagination();
            }
        });

        updatePagination();

    </script>





